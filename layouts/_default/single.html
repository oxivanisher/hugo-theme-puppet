{{ define "main" }}
<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">

      <!-- Post Container -->
      <div class="
              col-lg-8 col-lg-offset-2
              col-md-10 col-md-offset-1
              post-container">
        {{ if isset .Params "feature_img" }}
        {{ $thumbnailResizeOptions := .Site.Params.postFeatureImgResizeOptions | default "300x150 q85 Lanczos" }}

        {{ $original := .Page.Resources.GetMatch (.Params.feature_img) }}

        {{/* Get metadata from sidecar file, if present. Else an empty dictionary is used. */}}
        {{ $metaFileName := print $original.Name ".meta"}}
        {{ $metadata := .Resources.GetMatch ($metaFileName) }}
        {{ if $metadata }}
        {{ $metadata = $metadata.Content }}
        {{ $metadata = $metadata | unmarshal }}
        {{ else }}
        {{ $metadata = dict }}
        {{ end }}

        {{/* Compute rotation to correct orientation of thumbnail (and downscaled gallery images) in case the exif
        contains
        a
        value for orientation. See issue #22. */}}
        {{ $rotation := "" }}
        {{ with $metadata.Orientation }}
        {{/* Exif orientation is explained here: https://www.impulseadventure.com/photo/exif-orientation.html */}}
        {{/* Example images can be found here: https://github.com/recurser/exif-orientation-examples*/}}
        {{/* We can fix orientation 3, 6 and 8 by rotating. */}}
        {{/* To fix orientation 2, 4, 5, 6 we would need to flip the image, sadly hugo can not do that. */}}
        {{/* So we can only fix them a "bit" by rotating them but they will be mirrored. */}}
        {{/* An orientation of 2 means that the image only needs to be flipped so we do nothing in that case. */}}
        {{/* An orientation of 1 means that the image has the correct rotation and is not mirrored. */}}
        {{ if or (eq . 8) (eq . 7) }}
        {{ $rotation = " r90" }}
        {{ else if or (eq . 3) (eq . 4) }}
        {{ $rotation = " r180" }}
        {{ else if or (eq . 6) (eq . 5) }}
        {{ $rotation = " r270" }}
        {{ end }}
        {{ end }}

        {{/* Create thumbnail, rotate it if needed */}}
        {{ $thumbnail := ($original.Resize (printf "%s %s" $thumbnailResizeOptions $rotation)) }}
        <img src="{{ $thumbnail.RelPermalink }}" title="{{ .Title }}">
        {{ end }}
        {{ .Content }}

        <hr style="visibility: hidden;" />
        <ul class="pager">
          {{ with .Prev }}
          <li class="previous">
            <a href="{{ .RelPermalink }}" data-toggle="tooltip" data-placement="top" title="{{ .Title }}">
              Previous<br>
              <span>{{ .Title }}</span>
            </a>
          </li>
          {{ end }}
          {{ with .Next }}
          <li class="next">
            <a href="{{ .RelPermalink }}" data-toggle="tooltip" data-placement="top" title="{{ .Title }}">
              Next<br>
              <span>{{ .Title }}</span>
            </a>
          </li>
          {{ end }}
        </ul>
        <hr style="visibility: hidden;" />

        <!-- comments -->
        {{ partial "comments.html" . }}

      </div>

      <!-- Side Catalog Container -->
      {{ $toc := .Scratch.Get "toc" }}
      {{ if $toc }}
      <div class="
              col-lg-2 col-lg-offset-0
              visible-lg-block
              sidebar-container
              catalog-container">
        <div class="side-catalog">
          <hr class="hidden-sm hidden-xs">
          <h5>
            <a class="catalog-toggle" href="#">CATALOG</a>
          </h5>
          <ul class="catalog-body"></ul>
        </div>
      </div>
      {{ end }}
      <!-- Sidebar Container -->
      <div class="
              col-lg-8 col-lg-offset-2
              col-md-10 col-md-offset-1
              sidebar-container">

        <!-- Featured Tags -->
        {{ .Scratch.Set "bottom" true }}
        {{ partial "featured-tags.html" . }}

        <!-- Friends Blog -->
        {{ partial "friends.html" . }}
      </div>
    </div>
  </div>
</article>

{{ end }}
