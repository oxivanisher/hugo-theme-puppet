<div class="post-preview">
  <a href="{{ .RelPermalink }}">
    {{ if isset .Params "feature_img" }}
    {{ $thumbnailResizeOptions := .Site.Params.postPreviewFeatureImgResizeOptions | default "160x160 q85 Lanczos" }}

    {{ $original := .Page.Resources.GetMatch (.Params.feature_img) }}

    {{/* Get metadata from sidecar file, if present. Else an empty dictionary is used. */}}
    {{ $metaFileName := print $original.Name ".meta"}}
    {{ $metadata := .Resources.GetMatch ($metaFileName) }}
    {{ if $metadata }}
    {{ $metadata = $metadata.Content }}
    {{ $metadata = $metadata | unmarshal }}
    {{ else }}
    {{ $metadata = dict }}
    {{ end }}

    {{/* Compute rotation to correct orientation of thumbnail (and downscaled gallery images) in case the exif contains
    a
    value for orientation. See issue #22. */}}
    {{ $rotation := "" }}
    {{ with $metadata.Orientation }}
    {{/* Exif orientation is explained here: https://www.impulseadventure.com/photo/exif-orientation.html */}}
    {{/* Example images can be found here: https://github.com/recurser/exif-orientation-examples*/}}
    {{/* We can fix orientation 3, 6 and 8 by rotating. */}}
    {{/* To fix orientation 2, 4, 5, 6 we would need to flip the image, sadly hugo can not do that. */}}
    {{/* So we can only fix them a "bit" by rotating them but they will be mirrored. */}}
    {{/* An orientation of 2 means that the image only needs to be flipped so we do nothing in that case. */}}
    {{/* An orientation of 1 means that the image has the correct rotation and is not mirrored. */}}
    {{ if or (eq . 8) (eq . 7) }}
    {{ $rotation = " r90" }}
    {{ else if or (eq . 3) (eq . 4) }}
    {{ $rotation = " r180" }}
    {{ else if or (eq . 6) (eq . 5) }}
    {{ $rotation = " r270" }}
    {{ end }}
    {{ end }}

    {{/* Create thumbnail, rotate it if needed */}}
    {{ $thumbnail := ($original.Fill (printf "%s %s" $thumbnailResizeOptions $rotation)) }}
    <img class="post-content-preview-thumbnail" src="{{ $thumbnail.RelPermalink }}">
    {{ end }}

    <h2 class="post-title">{{ .Title }}</h2>
    {{ with .Params.subtitle }}
    <h3 class="post-subtitle">{{ . }}</h3>
    {{ end }}
    <div class="post-content-preview">
      {{ if isset .Params "description" }} {{ index .Params "description" }}
      {{ else }}
      {{ .Summary | plainify | truncate 180 }}
      {{ end }}
    </div>
  </a>
  <p class="post-meta">
    Gepostet von {{ with $.Params.author }} {{ $.Params.author }} {{ else }} {{ .Site.Params.author }} {{ end }} am {{
    .Date.Format "Mon, Jan 2, 2006" }}
  </p>
</div>
<hr>
